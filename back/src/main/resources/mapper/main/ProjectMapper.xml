<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="njnu.edu.back.dao.main.ProjectMapper">
    <select id="addProject" resultType="java.lang.String">
        insert into project values(default, #{projectName}, #{email}, now(), #{avatar}, #{layerManage, typeHandler = njnu.edu.back.common.utils.ArrayTypeHandler}) returning id::text
    </select>

    <select id="fuzzyQuery" resultType="java.util.Map">
        select p.id as "id", project_name as "projectName", creator, create_time as "createTime", p.avatar as "avatar", layer_manage as "layerManage", name as "userName", u.avatar as "userAvatar"
        from project p, users u
        where u.email = p.creator
        <if test="keyword != ''">
            and project_name like #{keyword}
        </if>
        order by create_time asc
        limit #{size} offset #{start}
    </select>

    <select id="fuzzyCount" resultType="java.lang.Integer">
        select count(*) from project
        <if test="keyword != ''">
            where project_name like #{keyword}
        </if>
    </select>

    <select id="getProjectInfo" resultType="java.util.Map">
        select p.id as "id", project_name as "projectName", creator, create_time as "createTime", p.avatar as "avatar", layer_manage as "layerManage", name as "userName", u.avatar as "userAvatar"
        from project p, users u
        where p.id::text = #{projectId}
    </select>

    <update id="updateLayer">
        update project set layer_manage = #{layers, typeHandler = njnu.edu.back.common.utils.ArrayTypeHandler} where id::text = #{projectId}
    </update>
</mapper>