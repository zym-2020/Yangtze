<template>
    <div>
      <div ref="chart" class="chart"></div>
    </div>
  </template>
  
  <script lang="ts">
  import { defineComponent, onMounted, ref } from "vue";
  import * as echarts from "echarts";
  import { getLastOrNextFewDateBy } from "@/utils/common";
  import { getDataGroup, QueryHeightByName } from "@/api/request";
  import router from "@/router";
  export default defineComponent({
    props: {
      getName: {
        type: String,
      },
    },
    setup(props) {
      const chart = ref<HTMLElement>();
      const dataMap = {
        dataGDP: [],
        dataPI: [],
        dataSI: [],
        dataTI: [],
      };
      const optionTemp = ref<any[]>([]);
      const timeLineTemp = ref<any[]>([]);
      const dateList=['06-13 05:00:00', '06-13 06:00:00', '06-13 07:00:00', '06-13 08:00:00', '06-13 09:00:00', '06-13 10:00:00', '06-13 11:00:00', '06-13 12:00:00', '06-13 13:00:00',
       '06-13 14:00:00', '06-13 15:00:00', '06-13 16:00:00', '06-13 17:00:00', '06-13 18:00:00', '06-13 19:00:00',
       '06-13 20:00:00', '06-13 21:00:00', '06-13 22:00:00', '06-13 23:00:00', '06-14 00:00:00', '06-14 01:00:00', '06-14 02:00:00', '06-14 03:00:00', 
       '06-14 04:00:00', '06-14 05:00:00', '06-14 06:00:00', '06-14 07:00:00', '06-14 08:00:00', '06-14 09:00:00', '06-14 10:00:00', '06-14 11:00:00', '06-14 12:00:00']
      const chartInit = async () => {
        for (let i = 0; i <= 29; i++) {
          timeLineTemp.value.push(String(i));
        }
        function dataFormatter(obj: any) {
          // prettier-ignore
          var pList =['如皋中汊', '如皋右汊', '天生港水道', '九龙港', '通州沙左', '通州沙右', '新开沙夹槽', '狼山沙东', '狼山沙西', '福山水道'];
          var temp;
  
          for (var year = 0; year <= 29; year++) {
            var max = 0;
            var sum = 0;
            temp = obj[year];
            for (var i = 0, l = temp.length; i < l; i++) {
              max = Math.max(max, temp[i]);
              sum += temp[i];
              obj[year][i] = {
                name: pList[i],
                value: temp[i],
              };
            }
            obj["max" + year] = Math.floor(max / 100) * 100;
            obj["sum" + year] = sum;
          }
          return obj;
        }
        dataMap.dataGDP = dataFormatter({
          //max : 60000,
0:[20908.0, 44242.0, 222.0, 60691.0, 56383.0, 7274.0, 6379.0, 56181.0, 17868.0, -61.0],

1:[21065.0, 39128.0, 173.0, 58043.0, 50715.0, 5813.0, 3879.0, 34213.0, 8194.0, -1142.0],

2:[18812.0, 31123.0, 188.0, 48120.0, 21255.0, -1170.0, -3965.0, -22436.0, -14333.0, -3684.0],

3:[7375.0, 7611.0, 518.0, 2212.0, -16118.0, -8022.0, -2321.0, -24600.0, -14046.0, -1627.0],

4:[-118.0, -12505.0, -201.0, -19362.0, -18254.0, -5033.0, -893.0, -13010.0, -8312.0, -411.0],

5:[1538.0, -6709.0, 68.0, -5514.0, -3417.0, 969.0, 2018.0, 8731.0, 854.0, 933.0],

6:[6765.0, 7589.0, 224.0, 19132.0, 21066.0, 8297.0, 4722.0, 34031.0, 11928.0, 876.0],

7:[11425.0, 21287.0, 255.0, 35329.0, 36643.0, 8753.0, 6151.0, 42400.0, 16362.0, 946.0],

8:[12828.0, 28525.0, 280.0, 44441.0, 43010.0, 8225.0, 5708.0, 46934.0, 19829.0, 558.0],

9:[14445.0, 32334.0, 232.0, 46855.0, 45885.0, 6193.0, 6015.0, 47073.0, 20353.0, 420.0],

10:[15104.0, 33662.0, 205.0, 49439.0, 46807.0, 5400.0, 5657.0, 48558.0, 20302.0, 161.0],

11:[15943.0, 34326.0, 187.0, 49129.0, 46842.0, 4303.0, 5137.0, 45854.0, 18014.0, 318.0],

12:[17128.0, 34102.0, 155.0, 50771.0, 46697.0, 3917.0, 4379.0, 44275.0, 15914.0, -129.0],

13:[17657.0, 31505.0, 139.0, 48283.0, 40889.0, 3018.0, -2668.0, 3708.0, -3846.0, -3301.0],

14:[14414.0, 23269.0, 181.0, 31427.0, -22268.0, -12788.0, -5049.0, -80355.0, -31738.0, -4806.0],

15:[-9340.0, -29570.0, -655.0, -45843.0, -59000.0, -17056.0, -2149.0, -75457.0, -34396.0, -4166.0],

16:[-13917.0, -40547.0, -536.0, -58804.0, -57291.0, -14376.0, -954.0, -65901.0, -18162.0, -2205.0],

17:[-11444.0, -30193.0, -352.0, -42312.0, -33913.0, -5063.0, 2683.0, -29881.0, -9098.0, -269.0],

18:[-6560.0, -15766.0, -180.0, -15105.0, -5387.0, 4640.0, 7034.0, 13704.0, 5650.0, 1474.0],

19:[2020.0, 4486.0, 333.0, 11637.0, 20877.0, 9196.0, 6473.0, 36610.0, 16308.0, 2150.0],

20:[8093.0, 20165.0, 355.0, 35206.0, 38841.0, 10622.0, 6916.0, 49397.0, 19945.0, 1479.0],

21:[12341.0, 30581.0, 415.0, 45300.0, 48013.0, 9887.0, 6020.0, 49140.0, 20499.0, 1112.0],

22:[15513.0, 35909.0, 381.0, 52018.0, 49344.0, 8063.0, 6571.0, 53726.0, 20992.0, 632.0],

23:[17151.0, 38899.0, 327.0, 55554.0, 52000.0, 7690.0, 6041.0, 52560.0, 21893.0, 559.0],

24:[18167.0, 39017.0, 281.0, 58503.0, 54002.0, 6417.0, 5550.0, 55029.0, 19374.0, 202.0],

25:[19649.0, 37856.0, 212.0, 56261.0, 52036.0, 4912.0, 5213.0, 49434.0, 17186.0, 106.0],

26:[19152.0, 34949.0, 187.0, 53777.0, 46121.0, 4005.0, 108.0, 7144.0, 3400.0, -2765.0],

27:[17994.0, 27964.0, 177.0, 37637.0, -4913.0, -9647.0, -3571.0, -36116.0, -18194.0, -2524.0],

28:[-597.0, -12169.0, -732.0, -25048.0, -20381.0, -10150.0, -2321.0, -37349.0, -16155.0, -2125.0],

29:[-1005.0, -21160.0, -782.0, -23876.0, -35849.0, -8634.0, -1322.0, 0.0, -14311.0, -2080.0],
        });
        // prettier-ignore
        dataMap.dataPI = dataFormatter({
      //max : 4000,
0:[12362.0, 29931.0, 219.0, 42531.0, 22150.0, 6020.0, 219.0, 35757.0, 16879.0, 362.0],

1:[13216.0, 24960.0, 216.0, 43130.0, 40552.0, 5129.0, 216.0, 31941.0, 14571.0, 135.0],

2:[13094.0, 21419.0, 190.0, 41192.0, 36337.0, 3898.0, 190.0, 19007.0, 9922.0, -775.0],

3:[11295.0, 17668.0, 226.0, 33186.0, 20505.0, 716.0, 226.0, -543.0, -533.0, -1426.0],

4:[6832.0, 13677.0, 152.0, 15107.0, 4601.0, -3908.0, 152.0, -11651.0, -4649.0, -1313.0],

5:[2060.0, 5231.0, -184.0, 2222.0, -3023.0, -4499.0, -184.0, -8846.0, -3334.0, -494.0],

6:[2522.0, 3124.0, -190.0, 3137.0, 3236.0, -1961.0, -190.0, 4227.0, 3174.0, 234.0],

7:[4869.0, 9128.0, -89.0, 14670.0, 16654.0, 2433.0, -89.0, 19338.0, 8716.0, 1076.0],

8:[8086.0, 17814.0, 133.0, 27830.0, 27595.0, 5488.0, 133.0, 31083.0, 14083.0, 836.0],

9:[10484.0, 23084.0, 238.0, 34668.0, 33842.0, 6183.0, 238.0, 33853.0, 16206.0, 994.0],

10:[10585.0, 27201.0, 216.0, 38523.0, 35960.0, 5919.0, 216.0, 37250.0, 17490.0, 638.0],

11:[12384.0, 29497.0, 198.0, 40557.0, 39749.0, 5014.0, 198.0, 37174.0, 16509.0, 701.0],

12:[12264.0, 30178.0, 193.0, 42111.0, 41416.0, 4929.0, 193.0, 38559.0, 17397.0, 349.0],

13:[14076.0, 30717.0, 186.0, 44883.0, 41751.0, 4894.0, 186.0, 35423.0, 15105.0, 237.0],

14:[12912.0, 29756.0, 185.0, 44775.0, 39707.0, 4055.0, 185.0, 27392.0, 12791.0, -320.0],

15:[12726.0, 26479.0, 158.0, 39705.0, 28954.0, 2547.0, 158.0, 6896.0, 2941.0, -1639.0],

16:[9166.0, 19826.0, 206.0, 25091.0, 9273.0, -3440.0, 206.0, -14040.0, -5692.0, -1394.0],

17:[2796.0, 5414.0, -79.0, 1649.0, -7048.0, -5656.0, -79.0, -17028.0, -7271.0, -1098.0],

18:[110.0, -2056.0, -171.0, -6564.0, -8070.0, -4877.0, -171.0, -12500.0, -4783.0, -574.0],

19:[1651.0, -540.0, -164.0, -732.0, -1544.0, -2189.0, -164.0, -1032.0, -632.0, 286.0],

20:[3782.0, 5012.0, -27.0, 11134.0, 13131.0, 2961.0, -27.0, 16556.0, 7318.0, 862.0],

21:[6994.0, 14300.0, 131.0, 23423.0, 24245.0, 4801.0, 131.0, 27122.0, 12359.0, 1148.0],

22:[9443.0, 21198.0, 257.0, 32021.0, 32914.0, 5674.0, 257.0, 33518.0, 16026.0, 974.0],

23:[11052.0, 25785.0, 280.0, 37029.0, 36910.0, 5058.0, 280.0, 36411.0, 17406.0, 881.0],

24:[13240.0, 28744.0, 187.0, 41488.0, 39548.0, 5484.0, 187.0, 37011.0, 17460.0, 949.0],

25:[12979.0, 30328.0, 248.0, 44418.0, 41851.0, 4540.0, 248.0, 37841.0, 17512.0, 766.0],

26:[12887.0, 30186.0, 173.0, 44102.0, 41467.0, 4194.0, 173.0, 33262.0, 15603.0, 91.0],

27:[16606.0, 28664.0, 151.0, 8849.0, 36663.0, 2908.0, 151.0, 23568.0, 12018.0, -263.0],

28:[11805.0, 25166.0, 163.0, 6721.0, 25308.0, 822.0, 163.0, 1645.0, 2176.0, -1424.0],

29:[7904.0, 18244.0, 198.0, 2630.0, 6893.0, -3750.0, 198.0, -8706.0, -2955.0, -598.0],

//30:[2915.0, 6958.0, -123.0, 4237.0, 302.0, -3778.0, -123.0, -7558.0, -1830.0, -236.0],

//31:[3789.0, 5376.0, -127.0, 5006.0, 4589.0, -1480.0, -127.0, 3848.0, 2653.0, 897.0],
  });
        // prettier-ignore
        dataMap.dataSI = dataFormatter({
      //max : 26600,
       
0:[2681.36, 1929.71, 20.66, 5695.68, 2983.34, 1210.75, 561.36, 3202.21, 1871.45, -7.42],

1:[2652.3, 2193.84, 14.36, 5622.91, 2739.87, 737.26, 415.07, 1551.93, -195.8, -40.38],

2:[3125.56, 2123.57, 14.7, 3867.07, 703.95, -103.18, -642.39, -906.77, -985.92, -173.45],

3:[1121.34, -8.59, 88.63, -122.19, -620.55, -922.63, -227.49, -986.32, -892.6, -56.01],

4:[342.61, -912.14, -83.78, -1227.88, -680.38, -509.19, -124.1, -536.89, -687.61, -22.6],

5:[194.53, -418.74, 5.33, -219.17, -129.86, 71.78, 296.7, 120.6, -75.7, 22.32],

6:[313.46, 470.26, 13.21, 459.33, 552.14, 849.91, 306.9, 825.74, 682.49, 20.34],

7:[688.78, 1746.71, 22.97, 1404.71, 1072.43, 1386.26, 793.52, 1485.02, 1301.2, 15.08],

8:[1164.73, 1194.98, 23.77, 2177.26, 1650.98, 936.97, 736.33, 1940.04, 1575.78, 12.12],

9:[1213.46, 1088.85, 16.25, 2376.07, 2458.05, 476.66, 763.85, 2202.17, 2051.59, 6.22],

10:[1675.56, 964.19, 11.29, 2407.9, 1965.41, 435.53, 724.06, 2392.46, 1848.86, 7.41],

11:[1935.7, 929.35, 10.82, 3415.0, 2079.52, 298.0, 570.16, 2435.76, 1099.11, 5.88],

12:[1807.2, 1495.05, 9.33, 3533.15, 1518.39, 252.22, 420.4, 1771.86, 1075.49, -8.75],

13:[2472.83, 1383.12, 8.61, 3462.27, 1470.59, 137.97, -160.09, -218.47, -495.27, -74.74],

14:[1862.5, 736.95, 18.24, 1780.9, -1401.93, -588.18, -2948.73, -4157.61, -4757.78, -347.79],

15:[-358.05, -2051.45, -112.61, -2666.26, -4730.9, -3906.29, -541.65, -10235.26, -11201.4, -362.2],

16:[-4023.7, -2814.75, -736.59, -4608.42, -6461.48, -5619.74, -176.56, -7750.65, -6405.41, -70.36],

17:[-1519.27, -2114.08, -139.9, -2895.37, -3544.59, -911.53, 169.03, -2636.86, -1206.83, -10.91],

18:[-763.11, -849.2, -46.21, -847.07, -349.36, 458.47, 1083.22, 511.26, -53.62, 45.83],

19:[74.6, 288.77, 29.01, 636.46, 901.43, 1270.21, 1359.27, 1583.04, 2110.07, 95.23],

20:[209.99, 1136.66, 29.45, 1551.63, 1868.25, 1620.79, 767.69, 2744.27, 2618.8, 55.24],

21:[924.26, 1568.19, 43.62, 2736.63, 3110.06, 2366.21, 836.72, 4278.87, 2964.75, 36.61],

22:[2632.85, 1921.82, 38.09, 4015.84, 2451.85, 1616.21, 985.7, 4135.83, 2975.08, 20.71],

23:[3669.69, 1585.17, 34.38, 4669.64, 3196.84, 1639.44, 773.18, 4242.37, 3232.61, 35.03],

24:[2322.88, 1619.18, 27.0, 4872.45, 3093.52, 1257.63, 610.5, 3555.07, 2386.82, 7.15],

25:[3199.74, 1452.91, 19.5, 5589.93, 3248.72, 677.45, 458.77, 2920.14, 1681.69, 3.88],

26:[3635.38, 971.5, 12.74, 5078.79, 2298.09, 386.02, 6.18, 124.31, -391.57, -83.42],

27:[3032.81, 801.73, 18.06, 2590.33, -489.25, -665.1, -839.25, -2319.99, -1061.95, -206.85],

28:[1414.13, -1411.59, -147.88, -1504.67, -2972.65, -1922.87, -422.48, -2622.02, -1176.66, -148.98],

29:[189.81, -1798.88, -157.96, -1860.93, -4509.63, -1635.78, -240.57, 0.0, 0.0, 0.0],
  });
        // prettier-ignore
        dataMap.dataTI = dataFormatter({
      //max : 25000,
     
0:[1070.83, 591.65, 9.85, 1910.16, 1675.2, 231.74, 101.21, 597.55, 483.14, 7.39],

1:[1095.04, 505.59, 11.86, 2127.38, 1242.65, 166.75, 90.09, 511.52, 630.42, 2.75],

2:[1137.41, 316.66, 7.97, 2145.86, 1065.84, 146.96, 44.28, 261.17, 224.52, -6.46],

3:[1138.46, 304.69, 10.4, 1402.58, 540.69, 20.56, -22.99, -49.6, -253.07, -11.43],

4:[659.02, 198.18, 7.74, 396.27, -34.31, -111.36, -41.66, -163.03, -151.77, -9.69],

5:[322.83, 44.95, -6.61, -126.71, -167.03, -134.96, -44.29, -133.37, -104.42, -4.85],

6:[255.66, 28.27, -14.47, -137.27, 0.86, -47.97, -2.6, 6.27, 87.67, 3.75],

7:[142.5, 112.25, -4.08, 274.27, 241.6, 56.98, 30.34, 162.71, 197.04, 30.85],

8:[194.39, 235.69, 4.12, 689.77, 574.3, 104.01, 69.16, 431.16, 263.31, 11.98],

9:[379.22, 571.81, 5.48, 1145.23, 780.22, 114.56, 79.78, 519.07, 506.11, 13.39],

10:[805.61, 581.19, 9.93, 1796.24, 847.42, 133.48, 107.47, 764.89, 473.2, 8.71],

11:[1341.56, 548.68, 8.11, 1653.97, 1056.24, 120.89, 149.51, 677.61, 550.54, 6.93],

12:[1539.9, 767.87, 7.54, 2120.88, 1185.85, 156.09, 118.79, 831.1, 528.66, 10.52],

13:[1514.6, 726.21, 6.32, 2313.96, 1116.26, 172.42, 114.87, 771.49, 499.95, 9.43],

14:[1370.87, 615.87, 8.12, 2296.02, 918.43, 145.32, 89.95, 561.44, 389.89, -0.18],

15:[1497.06, 647.77, 5.85, 1903.97, 594.36, 78.15, 2.56, 34.3, -116.66, -16.5],

16:[1082.73, 281.71, 9.5, 1069.1, 83.39, -89.44, -64.02, -271.4, -360.62, -22.5],

17:[483.34, 33.24, -3.63, -224.14, -337.14, -200.75, -78.33, -362.65, -524.97, -11.97],

18:[426.85, -21.69, -8.53, -363.53, -364.78, -180.47, -57.64, -332.88, -173.98, -8.61],

19:[116.56, 0.75, -5.73, -149.7, -130.48, -66.91, -1.15, 10.88, -19.0, 1.65],

20:[151.19, 52.83, -0.68, 328.97, 252.53, 65.24, 55.56, 230.35, 138.17, 11.23],

21:[232.63, 199.71, 2.61, 851.41, 551.67, 125.02, 75.0, 457.61, 297.61, 12.23],

22:[249.77, 312.91, 7.72, 1085.68, 769.91, 210.43, 108.8, 595.51, 421.58, 12.0],

23:[789.41, 422.53, 13.46, 1263.85, 1185.82, 175.67, 176.27, 754.5, 601.71, 6.84],

24:[781.53, 666.43, 8.62, 1884.55, 1103.85, 162.35, 132.69, 823.77, 655.15, 13.04],

25:[1150.8, 866.99, 10.91, 2379.35, 1195.24, 141.31, 120.59, 767.15, 659.48, 12.25],

26:[1348.15, 788.86, 7.08, 2123.0, 1238.94, 139.22, 149.65, 719.69, 571.94, 10.86],

27:[1259.72, 650.69, 6.18, 1883.2, 907.81, 101.35, 70.7, 394.64, 327.39, -3.95],

28:[966.34, 557.61, 7.67, 1191.7, 427.52, 26.37, -25.89, 9.47, -136.06, -30.62],

29:[775.23, 247.11, 9.52, 690.91, 68.39, -95.45, -42.5, -180.05, -150.45, -18.14],

//30:[476.43, 30.2, -3.68, -166.54, -96.09, -113.45, -28.16, -128.28, -59.57, -0.96],

//31:[289.67, 9.25, -6.61, -438.63, 0.02, -45.11, -9.85, 26.13, 113.96, 7.57],
  });
        // prettier-ignore
  
        for(let i =0 ;i< 29;i++){
      let istr:string=String(i);
  optionTemp.value.push({
        
        title: { text: dateList[istr as unknown as number] },
        series: [
          { data: (dataMap.dataGDP as any)[istr] },
          { data: (dataMap.dataPI as any)[istr] },
          { data: (dataMap.dataSI as any)[istr] },
          { data: (dataMap.dataTI as any)[istr] },
        ] 
  })
    }
        const option = {
          baseOption: {
            timeline: {
              left: 200,
              axisType: "category",
              // realtime: false,
              // loop: false,
              autoPlay: true,
              // currentIndex: 2,
              playInterval: 1000,
              // controlStyle: {
              //     position: 'left'
              // },
              data: timeLineTemp.value,
              label: {
                formatter: function (s: any) {
                  return s;
                },
              },
            },
            title: {
              subtext: "数据来自南京市水利科学院",
            },
            tooltip: {},
            legend: {
              left: "right",
              data: ["大潮流量", "小潮流量", "大潮输沙率", "小潮输沙率"],
              selected: {
                小潮输沙率: false,
                金融: false,
                房地产: false,
              },
            },
            calculable: true,
            grid: {
              top: 80,
              bottom: 100,
              tooltip: {
                trigger: "axis",
                axisPointer: {
                  type: "shadow",
                  label: {
                    show: true,
                    formatter: function (params: any) {
                      return params.value.replace("\n", "");
                    },
                  },
                },
              },
            },
            xAxis: [
              {
                type: "category",
                axisLabel: { interval: 0 },
                data: [
                  "如皋中汊",
                  "\n如皋右汊",
                  "天生港水道",
                  "\n九龙港",
                  "通州沙左",
                  "\n通州沙右",
                  "新开沙夹槽",
                  "\n狼山沙东",
                  "狼山沙西",
                  "\n福山水道",
                ],
                splitLine: { show: false },
              },
            ],
            yAxis: [
              {
                type: "value",
                name: "立方米每秒",
              },
            ],
            series: [
              { name: "大潮流量", type: "bar" },
              { name: "小潮流量", type: "bar" },
              { name: "大潮输沙率", type: "bar" },
              { name: "小潮输沙率", type: "bar" },
            ],
          },
          options: optionTemp.value,
        };
        const myChart = echarts.init(chart.value as HTMLElement, undefined, {
          height: 600,
          width: 950,
        });
        myChart.setOption(option as any);
      };
  
      onMounted(() => {
        chartInit();
      });
  
      return {
        chart,
        optionTemp,
      };
    },
  });
  </script>
  
  <style lang="scss" scoped>
  .chart {
    border: 1px solid #dcdfe6;
    border-radius: 8px;
    background: rgba($color: #d5e2fd, $alpha: 0.7);
  }
  </style>