<template>
  <div>
    <div ref="chart" class="chart"></div>
  </div>
</template>

<script lang="ts">
import { defineComponent, onMounted, ref } from "vue";
import * as echarts from "echarts";
import { getLastOrNextFewDateBy } from "@/utils/common";
import { getDataGroup, QueryHeightByName } from "@/api/request";
import router from "@/router";
export default defineComponent({
  props: {
    getName: {
      type: String,
    },
  },
  setup(props) {
    const chart = ref<HTMLElement>();
    const dataMap = {
      dataGDP: [],
      dataPI: [],
      dataSI: [],
      dataTI: [],
    };
    const optionTemp = ref<any[]>([]);
    const timeLineTemp = ref<any[]>([]);
    const chartInit = async () => {
      for (let i = 0; i <= 29; i++) {
        timeLineTemp.value.push(String(i));
      }
      function dataFormatter(obj: any) {
        // prettier-ignore
        var pList =['如皋中汊', '如皋右汊', '天生港水道', '九龙港', '通州沙左', '通州沙右', '新开沙夹槽', '狼山沙东', '狼山沙西', '福山水道'];
        var temp;

        for (var year = 0; year <= 29; year++) {
          var max = 0;
          var sum = 0;
          temp = obj[year];
          for (var i = 0, l = temp.length; i < l; i++) {
            max = Math.max(max, temp[i]);
            sum += temp[i];
            obj[year][i] = {
              name: pList[i],
              value: temp[i],
            };
          }
          obj["max" + year] = Math.floor(max / 100) * 100;
          obj["sum" + year] = sum;
        }
        return obj;
      }
      dataMap.dataGDP = dataFormatter({
        //max : 60000,
        0: [
          20908.0, 44242.0, 222.0, 60691.0, 56383.0, 7274.0, 6379.0, 56181.0,
          17868.0, -61.0,
        ],
        1: [
          20908.0, 44242.0, 222.0, 60691.0, 56383.0, 7274.0, 6379.0, 56181.0,
          17868.0, -61.0,
        ],

        2: [
          21065.0, 39128.0, 173.0, 58043.0, 50715.0, 5813.0, 3879.0, 34213.0,
          8194.0, -1142.0,
        ],

        3: [
          18812.0, 31123.0, 188.0, 48120.0, 21255.0, -1170.0, -3965.0, -22436.0,
          -14333.0, -3684.0,
        ],

        4: [
          7375.0, 7611.0, 518.0, 2212.0, -16118.0, -8022.0, -2321.0, -24600.0,
          -14046.0, -1627.0,
        ],

        5: [
          -118.0, -12505.0, -201.0, -19362.0, -18254.0, -5033.0, -893.0,
          -13010.0, -8312.0, -411.0,
        ],

        6: [
          1538.0, -6709.0, 68.0, -5514.0, -3417.0, 969.0, 2018.0, 8731.0, 854.0,
          933.0,
        ],

        7: [
          6765.0, 7589.0, 224.0, 19132.0, 21066.0, 8297.0, 4722.0, 34031.0,
          11928.0, 876.0,
        ],

        8: [
          11425.0, 21287.0, 255.0, 35329.0, 36643.0, 8753.0, 6151.0, 42400.0,
          16362.0, 946.0,
        ],

        9: [
          12828.0, 28525.0, 280.0, 44441.0, 43010.0, 8225.0, 5708.0, 46934.0,
          19829.0, 558.0,
        ],

        10: [
          14445.0, 32334.0, 232.0, 46855.0, 45885.0, 6193.0, 6015.0, 47073.0,
          20353.0, 420.0,
        ],

        11: [
          15104.0, 33662.0, 205.0, 49439.0, 46807.0, 5400.0, 5657.0, 48558.0,
          20302.0, 161.0,
        ],

        12: [
          15943.0, 34326.0, 187.0, 49129.0, 46842.0, 4303.0, 5137.0, 45854.0,
          18014.0, 318.0,
        ],

        13: [
          17128.0, 34102.0, 155.0, 50771.0, 46697.0, 3917.0, 4379.0, 44275.0,
          15914.0, -129.0,
        ],

        14: [
          17657.0, 31505.0, 139.0, 48283.0, 40889.0, 3018.0, -2668.0, 3708.0,
          -3846.0, -3301.0,
        ],

        15: [
          14414.0, 23269.0, 181.0, 31427.0, -22268.0, -12788.0, -5049.0,
          -80355.0, -31738.0, -4806.0,
        ],

        16: [
          -9340.0, -29570.0, -655.0, -45843.0, -59000.0, -17056.0, -2149.0,
          -75457.0, -34396.0, -4166.0,
        ],

        17: [
          -13917.0, -40547.0, -536.0, -58804.0, -57291.0, -14376.0, -954.0,
          -65901.0, -18162.0, -2205.0,
        ],

        18: [
          -11444.0, -30193.0, -352.0, -42312.0, -33913.0, -5063.0, 2683.0,
          -29881.0, -9098.0, -269.0,
        ],

        19: [
          -6560.0, -15766.0, -180.0, -15105.0, -5387.0, 4640.0, 7034.0, 13704.0,
          5650.0, 1474.0,
        ],

        20: [
          2020.0, 4486.0, 333.0, 11637.0, 20877.0, 9196.0, 6473.0, 36610.0,
          16308.0, 2150.0,
        ],

        21: [
          8093.0, 20165.0, 355.0, 35206.0, 38841.0, 10622.0, 6916.0, 49397.0,
          19945.0, 1479.0,
        ],

        22: [
          12341.0, 30581.0, 415.0, 45300.0, 48013.0, 9887.0, 6020.0, 49140.0,
          20499.0, 1112.0,
        ],

        23: [
          15513.0, 35909.0, 381.0, 52018.0, 49344.0, 8063.0, 6571.0, 53726.0,
          20992.0, 632.0,
        ],

        24: [
          17151.0, 38899.0, 327.0, 55554.0, 52000.0, 7690.0, 6041.0, 52560.0,
          21893.0, 559.0,
        ],

        25: [
          18167.0, 39017.0, 281.0, 58503.0, 54002.0, 6417.0, 5550.0, 55029.0,
          19374.0, 202.0,
        ],

        26: [
          19649.0, 37856.0, 212.0, 56261.0, 52036.0, 4912.0, 5213.0, 49434.0,
          17186.0, 106.0,
        ],

        27: [
          19152.0, 34949.0, 187.0, 53777.0, 46121.0, 4005.0, 108.0, 7144.0,
          3400.0, -2765.0,
        ],

        28: [
          17994.0, 27964.0, 177.0, 37637.0, -4913.0, -9647.0, -3571.0, -36116.0,
          -18194.0, -2524.0,
        ],

        29: [
          -597.0, -12169.0, -732.0, -25048.0, -20381.0, -10150.0, -2321.0,
          -37349.0, -16155.0, -2125.0,
        ],
      });
      // prettier-ignore
      dataMap.dataPI = dataFormatter({
    //max : 4000,
     0:[-1005.0, -21160.0, -782.0, -23876.0, -35849.0, -8634.0, -1322.0, '', -14311.0, -2080.0],
 1:[-1005.0, -21160.0, -782.0, -23876.0, -35849.0, -8634.0, -1322.0, '', -14311.0, -2080.0],

2:[12362.0, 29931.0, 219.0, 42531.0, 22150.0, 6020.0, 219.0, 35757.0, 16879.0, 362.0],

3:[13216.0, 24960.0, 216.0, 43130.0, 40552.0, 5129.0, 216.0, 31941.0, 14571.0, 135.0],

4:[13094.0, 21419.0, 190.0, 41192.0, 36337.0, 3898.0, 190.0, 19007.0, 9922.0, -775.0],

5:[11295.0, 17668.0, 226.0, 33186.0, 20505.0, 716.0, 226.0, -543.0, -533.0, -1426.0],

6:[6832.0, 13677.0, 152.0, 15107.0, 4601.0, -3908.0, 152.0, -11651.0, -4649.0, -1313.0],

7:[2060.0, 5231.0, -184.0, 2222.0, -3023.0, -4499.0, -184.0, -8846.0, -3334.0, -494.0],

8:[2522.0, 3124.0, -190.0, 3137.0, 3236.0, -1961.0, -190.0, 4227.0, 3174.0, 234.0],

9:[4869.0, 9128.0, -89.0, 14670.0, 16654.0, 2433.0, -89.0, 19338.0, 8716.0, 1076.0],

10:[8086.0, 17814.0, 133.0, 27830.0, 27595.0, 5488.0, 133.0, 31083.0, 14083.0, 836.0],

11:[10484.0, 23084.0, 238.0, 34668.0, 33842.0, 6183.0, 238.0, 33853.0, 16206.0, 994.0],

12:[10585.0, 27201.0, 216.0, 38523.0, 35960.0, 5919.0, 216.0, 37250.0, 17490.0, 638.0],

13:[12384.0, 29497.0, 198.0, 40557.0, 39749.0, 5014.0, 198.0, 37174.0, 16509.0, 701.0],

14:[12264.0, 30178.0, 193.0, 42111.0, 41416.0, 4929.0, 193.0, 38559.0, 17397.0, 349.0],

15:[14076.0, 30717.0, 186.0, 44883.0, 41751.0, 4894.0, 186.0, 35423.0, 15105.0, 237.0],

16:[12912.0, 29756.0, 185.0, 44775.0, 39707.0, 4055.0, 185.0, 27392.0, 12791.0, -320.0],

17:[12726.0, 26479.0, 158.0, 39705.0, 28954.0, 2547.0, 158.0, 6896.0, 2941.0, -1639.0],

18:[9166.0, 19826.0, 206.0, 25091.0, 9273.0, -3440.0, 206.0, -14040.0, -5692.0, -1394.0],

19:[2796.0, 5414.0, -79.0, 1649.0, -7048.0, -5656.0, -79.0, -17028.0, -7271.0, -1098.0],

20:[110.0, -2056.0, -171.0, -6564.0, -8070.0, -4877.0, -171.0, -12500.0, -4783.0, -574.0],

21:[1651.0, -540.0, -164.0, -732.0, -1544.0, -2189.0, -164.0, -1032.0, -632.0, 286.0],

22:[3782.0, 5012.0, -27.0, 11134.0, 13131.0, 2961.0, -27.0, 16556.0, 7318.0, 862.0],

23:[6994.0, 14300.0, 131.0, 23423.0, 24245.0, 4801.0, 131.0, 27122.0, 12359.0, 1148.0],

24:[9443.0, 21198.0, 257.0, 32021.0, 32914.0, 5674.0, 257.0, 33518.0, 16026.0, 974.0],

25:[11052.0, 25785.0, 280.0, 37029.0, 36910.0, 5058.0, 280.0, 36411.0, 17406.0, 881.0],

26:[13240.0, 28744.0, 187.0, 41488.0, 39548.0, 5484.0, 187.0, 37011.0, 17460.0, 949.0],

27:[12979.0, 30328.0, 248.0, 44418.0, 41851.0, 4540.0, 248.0, 37841.0, 17512.0, 766.0],

28:[12887.0, 30186.0, 173.0, 44102.0, 41467.0, 4194.0, 173.0, 33262.0, 15603.0, 91.0],

29:[16606.0, 28664.0, 151.0, 8849.0, 36663.0, 2908.0, 151.0, 23568.0, 12018.0, -263.0],
});
      // prettier-ignore
      dataMap.dataSI = dataFormatter({
    //max : 26600,
     
 0:[11805.0, 25166.0, 163.0, 6721.0, 25308.0, 822.0, 163.0, 1645.0, 2176.0, -1424.0],

1:[7904.0, 18244.0, 198.0, 2630.0, 6893.0, -3750.0, 198.0, -8706.0, -2955.0, -598.0],

2:[2915.0, 6958.0, -123.0, 4237.0, 302.0, -3778.0, -123.0, -7558.0, -1830.0, -236.0],

3:[3789.0, 5376.0, -127.0, 5006.0, 4589.0, -1480.0, -127.0, 3848.0, 2653.0, 897.0],

4:[2681.358, 1929.714, 20.664, 5695.678, 2983.339, 1210.748, 561.361, 3202.209, 1871.4479999999999, -7.4239999999999995],

5:[2652.304, 2193.843, 14.358999999999998, 5622.91, 2739.874, 737.256, 415.07399999999996, 1551.929, -195.79699999999997, -40.376999999999995],

6:[3125.562, 2123.571, 14.695, 3867.067, 703.946, -103.184, -642.395, -906.774, -985.9230000000001, -173.454],

7:[1121.338, -8.588999999999999, 88.63, -122.187, -620.5459999999999, -922.6339999999999, -227.488, -986.321, -892.6010000000001, -56.014],

8:[342.611, -912.1389999999999, -83.775, -1227.883, -680.381, -509.189, -124.09899999999999, -536.8919999999999, -687.6129999999999, 
-22.6],

9:[194.53, -418.73699999999997, 5.335, -219.167, -129.856, 71.785, 296.705, 120.602, -75.703, 22.325],

10:[313.458, 470.265, 13.21, 459.326, 552.14, 849.915, 306.898, 825.7370000000001, 682.4939999999999, 20.336],

11:[688.7819999999999, 1746.708, 22.968000000000004, 1404.7060000000001, 1072.427, 1386.259, 793.518, 1485.0230000000001, 1301.196, 15.078],

12:[1164.726, 1194.985, 23.767, 2177.255, 1650.9759999999999, 936.973, 736.332, 1940.039, 1575.7759999999998, 12.116],

13:[1213.4569999999999, 1088.85, 16.247, 2376.075, 2458.0540000000005, 476.65599999999995, 763.854, 2202.172, 2051.587, 6.2219999999999995],

14:[1675.563, 964.19, 11.292, 2407.897, 1965.411, 435.526, 724.057, 2392.46, 1848.856, 7.406000000000001],

15:[1935.697, 929.348, 10.823, 3415.0, 2079.523, 297.995, 570.163, 2435.757, 1099.107, 5.882],

16:[1807.2, 1495.049, 9.33, 3533.152, 1518.387, 252.22400000000002, 420.403, 1771.857, 1075.4920000000002, -8.751999999999999],      

17:[2472.834, 1383.116, 8.612, 3462.272, 1470.5880000000002, 137.967, -160.09199999999998, -218.47, -495.27, -74.741],

18:[1862.502, 736.9480000000001, 18.241, 1780.901, -1401.933, -588.1759999999999, -2948.733, -4157.609, -4757.778, -347.793],        

19:[-358.046, -2051.445, -112.60799999999999, -2666.264, -4730.898999999999, -3906.292, -541.649, -10235.264, -11201.404, -362.204], 

20:[-4023.702, -2814.751, -736.588, -4608.419, -6461.478, -5619.743, -176.56400000000002, -7750.647000000001, -6405.407999999999, -70.362],

21:[-1519.272, -2114.077, -139.903, -2895.367, -3544.5919999999996, -911.533, 169.035, -2636.863, -1206.834, -10.911],

22:[-763.113, -849.202, -46.209, -847.071, -349.357, 458.474, 1083.221, 511.265, -53.61699999999999, 45.829],

23:[74.601, 288.77, 29.006, 636.458, 901.429, 1270.21, 1359.267, 1583.042, 2110.074, 95.22900000000001],

24:[209.99099999999999, 1136.665, 29.449, 1551.635, 1868.249, 1620.786, 767.687, 2744.272, 2618.7959999999994, 55.24],

25:[924.264, 1568.1860000000001, 43.617000000000004, 2736.6319999999996, 3110.059, 2366.2120000000004, 836.7239999999999, 4278.868, 2964.7520000000004, 36.607],

26:[2632.8450000000003, 1921.8230000000003, 38.09, 4015.839, 2451.846, 1616.2069999999999, 985.695, 4135.831, 2975.0769999999998, 20.707],

27:[3669.692, 1585.175, 34.376999999999995, 4669.643, 3196.838, 1639.438, 773.184, 4242.368, 3232.6089999999995, 35.035],

28:[2322.88, 1619.184, 27.004, 4872.455, 3093.5150000000003, 1257.635, 610.5, 3555.068, 2386.819, 7.152],

29:[3199.74, 1452.915, 19.504, 5589.932, 3248.724, 677.4509999999999, 458.771, 2920.143, 1681.688, 3.8819999999999997],
});
      // prettier-ignore
      dataMap.dataTI = dataFormatter({
    //max : 25000,
   
0:[3635.38, 971.4960000000001, 12.744, 5078.792, 2298.085, 386.023, 6.179, 124.306, -391.571, -83.416],

1:[3032.808, 801.7260000000001, 18.064, 2590.3289999999997, -489.252, -665.097, -839.255, -2319.9880000000003, -1061.954, -206.853], 

2:[1414.127, -1411.585, -147.88400000000001, -1504.6659999999997, -2972.6519999999996, -1922.87, -422.476, -2622.019, -1176.662, -148.977],

3:[189.815, -1798.882, -157.964, -1860.93, -4509.626, -1635.778, -240.56799999999998, '', '', ''],

4:[1070.826, 591.653, 9.846, 1910.159, 1675.2, 231.742, 101.21199999999999, 597.554, 483.143, 7.394],

5:[1095.036, 505.589, 11.863999999999999, 2127.378, 1242.654, 166.754, 90.087, 511.519, 630.421, 2.751],

6:[1137.408, 316.661, 7.9670000000000005, 2145.861, 1065.836, 146.964, 44.284, 261.171, 224.518, -6.462999999999999],

7:[1138.465, 304.688, 10.405, 1402.576, 540.689, 20.562, -22.988, -49.596, -253.075, -11.43],

8:[659.017, 198.183, 7.741, 396.26700000000005, -34.315, -111.358, -41.664, -163.027, -151.76700000000002, -9.686],

9:[322.828, 44.949, -6.614, -126.712, -167.03300000000002, -134.964, -44.286, -133.37099999999998, -104.423, -4.85],

10:[255.665, 28.267999999999997, -14.47, -137.268, 0.8610000000000002, -47.965, -2.597, 6.27, 87.668, 3.745],

11:[142.498, 112.24900000000001, -4.08, 274.274, 241.603, 56.978, 30.335, 162.708, 197.036, 30.851],

12:[194.386, 235.688, 4.116, 689.771, 574.297, 104.006, 69.161, 431.15700000000004, 263.30600000000004, 11.983],

13:[379.223, 571.808, 5.476, 1145.226, 780.22, 114.565, 79.781, 519.067, 506.10699999999997, 13.392],

14:[805.613, 581.193, 9.927, 1796.245, 847.421, 133.48, 107.468, 764.887, 473.2, 8.715],

15:[1341.558, 548.684, 8.11, 1653.969, 1056.2430000000002, 120.891, 149.513, 677.61, 550.5429999999999, 6.927],

16:[1539.903, 767.8660000000001, 7.542999999999999, 2120.8810000000003, 1185.846, 156.09300000000002, 118.79, 831.102, 528.665, 10.515],

17:[1514.598, 726.2139999999999, 6.324, 2313.956, 1116.261, 172.418, 114.87, 771.49, 499.94599999999997, 9.434000000000001],

18:[1370.865, 615.865, 8.122, 2296.017, 918.43, 145.318, 89.95100000000001, 561.437, 389.895, -0.178],

19:[1497.056, 647.775, 5.854, 1903.966, 594.357, 78.149, 2.56, 34.296, -116.657, -16.495],

20:[1082.726, 281.706, 9.498999999999999, 1069.1, 83.388, -89.43799999999999, -64.018, -271.405, -360.618, -22.497],

21:[483.336, 33.236000000000004, -3.629, -224.136, -337.14, -200.74599999999998, -78.326, -362.647, -524.968, -11.972999999999999],  

22:[426.845, -21.685999999999993, -8.525, -363.52700000000004, -364.784, -180.46800000000002, -57.635999999999996, -332.881, -173.976, -8.611],

23:[116.56, 0.75, -5.73, -149.7, -130.477, -66.913, -1.1520000000000001, 10.877999999999998, -18.997, 1.651],

24:[151.188, 52.833, -0.6829999999999999, 328.973, 252.529, 65.238, 55.559, 230.353, 138.166, 11.229],

25:[232.633, 199.70899999999997, 2.6140000000000003, 851.414, 551.6719999999999, 125.016, 75.001, 457.606, 297.61, 12.231],

26:[249.766, 312.907, 7.716, 1085.685, 769.911, 210.43100000000004, 108.804, 595.511, 421.582, 11.996],

27:[789.41, 422.529, 13.46, 1263.848, 1185.8210000000001, 175.67100000000002, 176.27, 754.495, 601.705, 6.845],

28:[781.5260000000001, 666.431, 8.62, 1884.548, 1103.851, 162.35299999999998, 132.686, 823.7719999999999, 655.151, 13.04],

29:[1150.7959999999998, 866.993, 10.911999999999999, 2379.346, 1195.241, 141.30599999999998, 120.58800000000001, 767.155, 659.479, 12.253],
});
      // prettier-ignore

      for(let i =0 ;i< 29;i++){
    let istr:string=String(i);
optionTemp.value.push({
      
      title: { text: istr+'2008/6/4  11:00:00' },
      series: [
        { data: (dataMap.dataGDP as any)[istr] },
        { data: (dataMap.dataPI as any)[istr] },
        { data: (dataMap.dataSI as any)[istr] },
        { data: (dataMap.dataTI as any)[istr] },
      ] 
})
  }
      const option = {
        baseOption: {
          timeline: {
            left: 200,
            axisType: "category",
            // realtime: false,
            // loop: false,
            autoPlay: true,
            // currentIndex: 2,
            playInterval: 1000,
            // controlStyle: {
            //     position: 'left'
            // },
            data: timeLineTemp.value,
            label: {
              formatter: function (s: any) {
                return s;
              },
            },
          },
          title: {
            subtext: "数据来自南京市水利科学院",
          },
          tooltip: {},
          legend: {
            left: "right",
            data: ["大潮流量", "小潮流量", "大潮输沙率", "小潮输沙率"],
            selected: {
              小潮输沙率: false,
              金融: false,
              房地产: false,
            },
          },
          calculable: true,
          grid: {
            top: 80,
            bottom: 100,
            tooltip: {
              trigger: "axis",
              axisPointer: {
                type: "shadow",
                label: {
                  show: true,
                  formatter: function (params: any) {
                    return params.value.replace("\n", "");
                  },
                },
              },
            },
          },
          xAxis: [
            {
              type: "category",
              axisLabel: { interval: 0 },
              data: [
                "如皋中汊",
                "\n如皋右汊",
                "天生港水道",
                "\n九龙港",
                "通州沙左",
                "\n通州沙右",
                "新开沙夹槽",
                "\n狼山沙东",
                "狼山沙西",
                "\n福山水道",
              ],
              splitLine: { show: false },
            },
          ],
          yAxis: [
            {
              type: "value",
              name: "立方米每秒",
            },
          ],
          series: [
            { name: "大潮流量", type: "bar" },
            { name: "小潮流量", type: "bar" },
            { name: "大潮输沙率", type: "bar" },
            { name: "小潮输沙率", type: "bar" },
          ],
        },
        options: optionTemp.value,
      };
      const myChart = echarts.init(chart.value as HTMLElement, undefined, {
        height: 600,
        width: 950,
      });
      myChart.setOption(option as any);
    };

    onMounted(() => {
      chartInit();
    });

    return {
      chart,
      optionTemp,
    };
  },
});
</script>

<style lang="scss" scoped>
.chart {
  border: 1px solid #dcdfe6;
  border-radius: 8px;
  background: rgba($color: #d5e2fd, $alpha: 0.7);
}
</style>